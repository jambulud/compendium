:toc: macro
toc::[]

|==================
|==================


== link:[] Chapter 21. Macros

link:[]

Macros are a mechanism for substituting parametrized text into output
documents.

Macros have a _name_ , a single _target_ argument and an _attribute
list_ .  The usual syntax is `&lt;name&gt;:&lt;target&gt;[&lt;attrlist&gt;]` (for
inline macros) and `&lt;name&gt;::&lt;target&gt;[&lt;attrlist&gt;]` (for block
macros).  Here are some examples:

*Macro behavior*

`&lt;name&gt;`*  is the macro name. It can only contain letters, digits or
  dash characters and cannot start with a dash.
* The optional 
`&lt;target&gt;`*  cannot contain white space characters.
`&lt;attrlist&gt;`*  is a 
link:ch29.html[list of attributes]*  enclosed in square
  brackets.
`]`*  characters inside attribute lists must be escaped with a
  backslash.
* Expansion of macro references can normally be escaped by prefixing a
  backslash character (see the AsciiDoc 
* _FAQ_
*  for examples of
  exceptions to this rule).
* Attribute references in block macros are expanded.
* The substitutions performed prior to Inline macro macro expansion
  are determined by the inline context.
* Macros are processed in the order they appear in the configuration
  file(s).
* Calls to inline macros can be nested inside different inline macros
  (an inline macro call cannot contain a nested call to itself).
* In addition to 
`&lt;name&gt;`* , 
`&lt;target&gt;`*  and 
`&lt;attrlist&gt;`*  the 
`&lt;passtext&gt;`*  and 
`&lt;subslist&gt;`*  named groups are available to 
link:ch21.html#X77[passthrough macros]* . A macro is a passthrough macro if the
  definition includes a 
`&lt;passtext&gt;`*  named group.


== link:[] 21.1. Inline Macros

link:[]

Inline Macros occur in an inline element context. Predefined Inline
macros include _URLs_ , _image_ and _link_ macros.

=== link:[] 21.1.1. URLs

link:[]

_http_ , _https_ , _ftp_ , _file_ , _mailto_ and _callto_ URLs are
rendered using predefined inline macros.

* If you don’t need a custom link caption you can enter the 
* _http_
* , 
* _https_
* , 
* _ftp_
* , 
* _file_
*  URLs and email addresses without any special
  macro syntax.
* If the 
`&lt;attrlist&gt;`*  is empty the URL is displayed.


Here are some examples:

Which are rendered:

link:http://www.docbook.org/[DocBook.org]

link:http://www.docbook.org/[http://www.docbook.org/]

link:mailto:joe.bloggs@foobar.com[email Joe Bloggs]

link:mailto:joe.bloggs@foobar.com[joe.bloggs@foobar.com]

If the `&lt;target&gt;` necessitates space characters use `%20` , for example`large%20image.png` .

=== link:[] 21.1.2. Internal Cross References

link:[]

Two AsciiDoc inline macros are provided for creating hypertext links
within an AsciiDoc document. You can use either the standard macro
syntax or the (preferred) alternative.

==== link:[] anchor

link:[]

Used to specify hypertext link targets:

The `&lt;id&gt;` is a unique string that conforms to the output markup’s
anchor syntax. The optional `&lt;xreflabel&gt;` is the text to be displayed
by captionless _xref_ macros that refer to this anchor. The optional`&lt;xreflabel&gt;` is only really useful when generating DocBook output.
Example anchor:

You may have noticed that the syntax of this inline element is the
same as that of the link:ch13.html[BlockId block element] , this is no
coincidence since they are functionally equivalent.

==== link:[] xref

link:[]

Creates a hypertext link to a document anchor.

The `&lt;id&gt;` refers to an anchor ID. The optional `&lt;caption&gt;` is the
link’s displayed text. Example:

If `&lt;caption&gt;` is not specified then the displayed text is
auto-generated:

* The AsciiDoc 
* _xhtml11_
*  and 
* _html5_
*  backends display the 
`&lt;id&gt;`* enclosed in square brackets.
* If DocBook is produced the DocBook toolchain is responsible for the
  displayed text which will normally be the referenced figure, table
  or section title number followed by the element’s title text.


Here is an example:

=== link:[] 21.1.3. Linking to Local Documents

link:[]

Hypertext links to files on the local file system are specified using
the _link_ inline macro.

The _link_ macro generates relative URLs. The link macro `&lt;target&gt;` is
the target file name (relative to the file system location of the
referring document). The optional `&lt;caption&gt;` is the link’s displayed
text. If `&lt;caption&gt;` is not specified then `&lt;target&gt;` is displayed.
Example:

You can use the `&lt;filename&gt;#&lt;id&gt;` syntax to refer to an anchor within
a target document but this usually only makes sense when targeting
HTML documents.

=== link:[] 21.1.4. Images

link:[]

Inline images are inserted into the output document using the _image_ macro. The inline syntax is:

The contents of the image file `&lt;target&gt;` is displayed. To display the
image its file format must be supported by the target backend
application. HTML and DocBook applications normally support PNG or JPG
files.

`&lt;target&gt;` file name paths are relative to the location of the
referring document.

link:[]

*Image macro attributes*

* The optional _alt_ attribute is also the first positional attribute,
  it specifies alternative text which is displayed if the output
  application is unable to display the image file (see also link:http://htmlhelp.com/feature/art3.htm[Use of ALT texts in IMGs] ). For
  example:
* image:images/logo.png[Company Logo]
* The optional 
* _title_
*  attribute provides a title for the image. The 
link:ch21.html#X49[block image macro]*  renders the title alongside the image.
  The inline image macro displays the title as a popup “tooltip” in
  visual browsers (AsciiDoc HTML outputs only).
* The optional `width` and `height` attributes scale the image size
  and can be used in any combination. The units are pixels.  The
  following example scales the previous example to a height of 32
  pixels:
* image:images/logo.png["Company Logo",height=32]
* The optional `link` attribute is used to link the image to an
  external document. The following example links a screenshot
  thumbnail to a full size version:
* image:screen-thumbnail.png[height=32,link="screen.png"]
* The optional `scaledwidth` attribute is only used in DocBook block
  images (specifically for PDF documents). The following example
  scales the images to 75% of the available print width:
* image::images/logo.png[scaledwidth="75%",alt="Company Logo"]
* The image 
`scale`*  attribute sets the DocBook 
`imagedata`*  element 
`scale`*  attribute.
* The optional `align` attribute aligns block macro images
  horizontally.  Allowed values are `center` , `left` and `right` . For
  example:
* image::images/tiger.png["Tiger image",align="left"]
* The optional 
`float`*  attribute floats the image 
`left`*  or 
`right`*  on
  the page (works with HTML outputs only, has no effect on DocBook
  outputs). 
`float`*  and 
`align`*  attributes are mutually exclusive.
  Use the 
`unfloat::[]`*  block macro to stop floating.


=== link:[] 21.1.5. Comment Lines

link:[]

See link:ch21.html#X25[comment block macro] .

== link:[] 21.2. Block Macros

link:[]

A Block macro reference must be contained in a single line separated
either side by a blank line or a block delimiter.

Block macros behave just like Inline macros, with the following
differences:

* They occur in a block context.
* The default syntax is 
`&lt;name&gt;::&lt;target&gt;[&lt;attrlist&gt;]`*  (two
  colons, not one).
* Markup template section names end in 
`-blockmacro`*  instead of 
`-inlinemacro`* .


=== link:[] 21.2.1. Block Identifier

link:[]

The Block Identifier macro sets the `id` attribute and has the same
syntax as the link:ch21.html#X30[anchor inline macro] since it performs
essentially the same function — block templates use the `id` attribute as a block element ID. For example:

This is equivalent to the `[id="X30"]`link:ch14.html[AttributeList element] ).

=== link:[] 21.2.2. Images

link:[]

The _image_ block macro is used to display images in a block context.
The syntax is:

The block `image` macro has the same link:ch21.html#X55[macro attributes] as it’slink:ch21.html#X9[inline image macro] counterpart.

Block images can be titled by preceding the _image_ macro with a _BlockTitle_ .  DocBook toolchains normally number titled block images
and optionally list them in an automatically generated _List of
Figures_ backmatter section.

This example:

is equivalent to:

A title prefix that can be inserted with the `caption` attribute
(HTML backends). For example:

link:[]

*Embedding images in XHTML documents*

If you define the `data-uri` attribute then images will be embedded in
XHTML outputs using thelink:http://en.wikipedia.org/wiki/Data:_URI_scheme[data URI scheme] .  You
can use the _data-uri_ attribute with the _xhtml11_ and _html5_ backends to produce single-file XHTML documents with embedded images
and CSS, for example:

|==================
|==================


=== link:[] 21.2.3. Comment Lines

link:[]

Single lines starting with two forward slashes hard up against the
left margin are treated as comments. Comment lines do not appear in
the output unless the _showcomments_ attribute is defined.  Comment
lines have been implemented as both block and inline macros so a
comment line can appear as a stand-alone block or within block elements
that support inline macro expansion. Example comment line:

If the _showcomments_ attribute is defined comment lines are written
to the output:

* In DocBook the comment lines are enclosed by the 
* _remark_
*  element
  (which may or may not be rendered by your toolchain).
* The 
* _showcomments_
*  attribute does not expose 
link:ch16.html#X26[Comment Blocks]* .
  Comment Blocks are never passed to the output.


== link:[] 21.3. System Macros

link:[]

System macros are block macros that perform a predefined task and are
hardwired into the `asciidoc(1)` program.

* You can escape system macros with a leading backslash character
  (as you can with other macros).
* The syntax and tasks performed by system macros is built into 
`asciidoc(1)`*  so they don’t appear in configuration files.  You can
  however customize the syntax by adding entries to a configuration
  file 
`[macros]`*  section.


=== link:[] 21.3.1. Include Macros

link:[]

The `include` and `include1` system macros to include the contents of
a named file into the source document.

The `include` macro includes a file as if it were part of the parent
document — tabs are expanded and system macros processed. The
contents of `include1` files are not subject to tab expansion or
system macro processing nor are attribute or lower priority
substitutions performed. The `include1` macro’s intended use is to
include verbatim embedded CSS or scripts into configuration file
headers.  Example:

*Include macro behavior*

* If the included file name is specified with a relative path then the
  path is relative to the location of the referring document.
* Include macros can appear inside configuration files.
* Files included from within 
* _DelimitedBlocks_
*  are read to completion
  to avoid false end-of-block underline termination.
* Attribute references are expanded inside the include 
* _target_
* ; if an
  attribute is undefined then the included file is silently skipped.
* The 
* _tabsize_
*  macro attribute sets the number of space characters to
  be used for tab expansion in the included file (not applicable to 
`include1`*  macro).
* The 
* _depth_
*  macro attribute sets the maximum permitted number of
  subsequent nested includes (not applicable to 
`include1`*  macro which
  does not process nested includes). Setting 
* _depth_
*  to 
* _1_
*  disables
  nesting inside the included file. By default, nesting is limited to
  a depth of ten.
* If the he 
* _warnings_
*  attribute is set to 
* _False_
*  (or any other
  Python literal that evaluates to boolean false) then no warning
  message is printed if the included file does not exist. By default 
* _warnings_
*  are enabled.
* Internally the 
`include1`*  macro is translated to the 
`include1`* system attribute which means it must be evaluated in a region where
  attribute substitution is enabled. To inhibit nested substitution in
  included files it is preferable to use the 
`include`*  macro and set
  the attribute 
`depth=1`* .


=== link:[] 21.3.2. Conditional Inclusion Macros

link:[]

Lines of text in the source document can be selectively included or
excluded from processing based on the existence (or not) of a document
attribute.

Document text between the `ifdef` and `endif` macros is included if a
document attribute is defined:

Document text between the `ifndef` and `endif` macros is not included
if a document attribute is defined:

`&lt;attribute&gt;` is an attribute name which is optional in the trailing`endif` macro.

If you only want to process a single line of text then the text can be
put inside the square brackets and the `endif` macro omitted, for
example:

Is equivalent to:

_ifdef_ and _ifndef_ macros also accept multiple attribute names:

* Multiple 
* _,_
*  separated attribute names evaluate to defined if one
  or more of the attributes is defined, otherwise it’s value is
  undefined.
* Multiple 
* _+_
*  separated attribute names evaluate to defined if all
  of the attributes is defined, otherwise it’s value is undefined.


Document text between the `ifeval` and `endif` macros is included if
the Python expression inside the square brackets is true. Example:

* Document attribute references are expanded before the expression is
  evaluated.
* If an attribute reference is undefined then the expression is
  considered false.


Take a look at the `*.conf` configuration files in the AsciiDoc
distribution for examples of conditional inclusion macro usage.

=== link:[] 21.3.3. Executable system macros

link:[]

The _eval_ , _sys_ and _sys2_ block macros exhibit the same behavior as
their same named link:ch30.html#X24[system attribute references] . The difference
is that system macros occur in a block macro context whereas system
attributes are confined to inline contexts where attribute
substitution is enabled.

The following example displays a long directory listing inside a
literal block:

|==================
|==================


=== link:[] 21.3.4. Template System Macro

link:[]

The `template` block macro allows the inclusion of one configuration
file template section within another.  The following example includes
the `[admonitionblock]` section in the `[admonitionparagraph]` section:

*Template macro behavior*

* The 
`template::[]`*  macro is useful for factoring configuration file
  markup.
`template::[]`*  macros cannot be nested.
`template::[]`*  macro expansion is applied after all configuration
  files have been read.


== link:[] 21.4. Passthrough macros

link:[]

Passthrough macros are analogous to link:ch16.html#X76[passthrough blocks] and are
used to pass text directly to the output. The substitution performed
on the text is determined by the macro definition but can be overridden
by the `&lt;subslist&gt;` .  The usual syntax is`&lt;name&gt;:&lt;subslist&gt;[&lt;passtext&gt;]` (for inline macros) and`&lt;name&gt;::&lt;subslist&gt;[&lt;passtext&gt;]` (for block macros). Passthroughs, by
definition, take precedence over all other text substitutions.

Inline and block. Passes text unmodified (apart from explicitly
  specified substitutions). Examples:

link:ch25.html[mathematical formulas]

Inline and block. The triple-plus passthrough is functionally
  identical to the _pass_ macro but you don’t have to escape `]` characters and you can prefix with quoted attributes in the inline
  version. Example:

Inline and block. The double-dollar passthrough is functionally
  identical to the triple-plus passthrough with one exception: special
  characters are escaped. Example:

link:[]

link:ch10.html#X81[plus character instead of a backtick]

== link:[] 21.5. Macro Definitions

link:[]

Each entry in the configuration `[macros]` section is a macro
definition which can take one of the following forms:

`&lt;pattern&gt;=&lt;name&gt;[&lt;subslist]`

`&lt;pattern&gt;=#&lt;name&gt;[&lt;subslist]`

`&lt;pattern&gt;=+&lt;name&gt;[&lt;subslist]`

`&lt;pattern&gt;`

`&lt;pattern&gt;`

`&lt;pattern&gt;` is a Python regular expression and `&lt;name&gt;` is the name of
a markup template. If `&lt;name&gt;` is omitted then it is the value of the
regular expression match group named _name_ .  The optional`[&lt;subslist]` is a comma-separated list of substitution names enclosed
in `[]` brackets, it sets the default substitutions for passthrough
text, if omitted then no passthrough substitutions are performed.

*Pattern named groups.* The following named groups can be used in macro `&lt;pattern&gt;` regular
expressions and are available as markup template attributes:

*Here’s what happens during macro substitution*

* Each contextually relevant macro 
* _pattern_
*  from the 
`[macros]`* section is matched against the input source line.
* If a match is found the text to be substituted is loaded from a
  configuration markup template section named like 
`&lt;name&gt;-inlinemacro`*  or 
`&lt;name&gt;-blockmacro`*  (depending on the macro
  type).
* Global and macro attribute list attributes are substituted in the
  macro’s markup template.
* The substituted template replaces the macro reference in the output
  document.


|==================
|==================




